services:
  asmr-collections:
    image: ghcr.io/kahosan/asmr-collections:latest
    container_name: asmr_collections
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - DATABASE_URL=postgresql://postgres:secret@database:5432/postgres
      - REDIS_URL=redis://redis:6379 # 不用 redis 也可以，但推荐开启以持久化缓存
      # 从 https://jina.ai 获取 API Key
      - JINA_API_KEY=
      # - VOICE_LIBRARY_PATH=/app/voices # 如果要使用本地库，取消注释这行
      # - HOST_URL=http://localhost:3000 # 同时设置为你的反代地址
    volumes:
      - ./covers:/app/covers # 封面文件夹
      # - ./voices:/app/voices # 左边的路径修改为你本地的音频文件夹路径
    depends_on:
      database:
        condition: service_healthy
      redis:
        condition: service_started
    restart: unless-stopped

  database:
    container_name: asmr_postgres
    image: pgvector/pgvector:pg17
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: secret # 请修改为更安全的密码
      POSTGRES_DB: postgres
    volumes:
      - ./pg-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready"]
    restart: unless-stopped

  redis:
    container_name: asmr_redis
    image: redis:8.2
    volumes:
      - ./redis-data:/data
    restart: unless-stopped